@{
	ViewData["Title"] = "Lecturer Dashboard";
	var recentClaims = ViewBag.RecentClaims as List<CMCS.Web.Models.Claim> ?? new List<CMCS.Web.Models.Claim>();
}

<div class="row">
	<div class="col-12">
		<h1 class="mb-1">ğŸ  Lecturer Dashboard</h1>
		<p class="text-muted mb-4">Welcome back! Here's an overview of your claims</p>

		<!-- Statistics Cards -->
		<div class="row g-3 mb-4">
			<div class="col-md-3">
				<div class="card border-primary shadow-sm">
					<div class="card-body text-center">
						<div class="display-4 text-primary mb-2">@ViewBag.TotalClaims</div>
						<h6 class="text-muted mb-0">Total Claims</h6>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card border-warning shadow-sm">
					<div class="card-body text-center">
						<div class="display-4 text-warning mb-2">@ViewBag.PendingClaims</div>
						<h6 class="text-muted mb-0">Pending Review</h6>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card border-success shadow-sm">
					<div class="card-body text-center">
						<div class="display-4 text-success mb-2">@ViewBag.ApprovedClaims</div>
						<h6 class="text-muted mb-0">Approved</h6>
					</div>
				</div>
			</div>
			<div class="col-md-3">
				<div class="card border-success shadow-sm">
					<div class="card-body text-center">
						<div class="display-6 text-success mb-2">R @ViewBag.TotalAmount.ToString("N2")</div>
						<h6 class="text-muted mb-0">Total Approved</h6>
					</div>
				</div>
			</div>
		</div>

		<!-- Quick Actions -->
		<div class="row g-3 mb-4">
			<div class="col-md-4">
				<div class="card border-primary shadow-sm h-100">
					<div class="card-body d-flex flex-column">
						<div class="text-center mb-3">
							<div class="display-1 text-primary">ğŸ“</div>
						</div>
						<h5 class="card-title text-center">Submit a Claim</h5>
						<p class="card-text text-center flex-grow-1">Create and submit your monthly claim</p>
						<a class="btn btn-primary" asp-controller="Lecturer" asp-action="Submit">Submit New Claim</a>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="card border-success shadow-sm h-100">
					<div class="card-body d-flex flex-column">
						<div class="text-center mb-3">
							<div class="display-1 text-success">ğŸ“‹</div>
						</div>
						<h5 class="card-title text-center">My Claims</h5>
						<p class="card-text text-center flex-grow-1">View and track all your claims</p>
						<a class="btn btn-success" asp-controller="Lecturer" asp-action="MyClaims">View All Claims</a>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="card border-info shadow-sm h-100">
					<div class="card-body d-flex flex-column">
						<div class="text-center mb-3">
							<div class="display-1 text-info">ğŸ“</div>
						</div>
						<h5 class="card-title text-center">Upload Documents</h5>
						<p class="card-text text-center flex-grow-1">Attach supporting documents</p>
						<a class="btn btn-info" asp-controller="Lecturer" asp-action="MyClaims">Manage Documents</a>
					</div>
				</div>
			</div>
		</div>

		<!-- Recent Claims with Status -->
		@if (recentClaims.Any())
		{
			<div class="card shadow-sm">
				<div class="card-header bg-light">
					<h5 class="card-title mb-0">ğŸ“Š Recent Claims & Status</h5>
				</div>
				<div class="card-body p-0">
					<div class="table-responsive">
						<table class="table table-hover mb-0">
							<thead class="table-light">
								<tr>
									<th>Claim #</th>
									<th>Period</th>
									<th>Amount</th>
									<th>Status</th>
									<th>Progress</th>
									<th class="text-center">Actions</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var claim in recentClaims)
								{
									var monthName = new DateTime(claim.Year, claim.Month, 1).ToString("MMMM");
									var statusViewModel = CMCS.Web.Models.ViewModels.ClaimStatusHelper.GetStatusViewModel(claim);
									var statusClass = CMCS.Web.Models.ViewModels.ClaimStatusHelper.GetStatusBadgeClass(claim.Status);

									<tr>
										<td class="fw-bold">#@claim.Id</td>
										<td>@monthName @claim.Year</td>
										<td class="fw-semibold">R @claim.Amount.ToString("N2")</td>
										<td>
											<span class="badge @statusClass">
												@CMCS.Web.Models.ViewModels.ClaimStatusHelper.GetStatusIcon(claim.Status) @claim.Status
											</span>
										</td>
										<td style="width: 200px;">
											@if (claim.Status != CMCS.Web.Models.ClaimStatus.Rejected)
											{
												<div class="progress" style="height: 20px;">
													<div class="progress-bar bg-@statusViewModel.StatusColor" 
														 role="progressbar" 
														 style="width: @statusViewModel.ProgressPercentage%;" 
														 aria-valuenow="@statusViewModel.ProgressPercentage" 
														 aria-valuemin="0" 
														 aria-valuemax="100">
														@statusViewModel.ProgressPercentage%
													</div>
												</div>
											}
											else
											{
												<span class="badge bg-danger">Rejected</span>
											}
										</td>
										<td class="text-center">
											<a asp-action="TrackClaim" asp-route-id="@claim.Id" class="btn btn-sm btn-outline-info">
												ğŸ“Š Track
											</a>
										</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
				</div>
				<div class="card-footer text-center">
					<a asp-action="MyClaims" class="btn btn-sm btn-outline-primary">View All Claims â†’</a>
				</div>
			</div>
		}
		else
		{
			<div class="card shadow-sm">
				<div class="card-body text-center py-5">
					<div class="display-1 text-muted mb-3">ğŸ“</div>
					<h5>No Claims Yet</h5>
					<p class="text-muted">Start by submitting your first claim</p>
					<a asp-action="Submit" class="btn btn-primary mt-2">Submit Your First Claim</a>
				</div>
			</div>
		}
	</div>
</div>


