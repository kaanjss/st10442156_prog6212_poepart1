@model IEnumerable<CMCS.Web.Models.Claim>
@{
	ViewData["Title"] = "Programme Coordinator - Verify Claims";
}

<div class="row">
	<div class="col-12">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<div>
				<h1 class="mb-1">üîç Programme Coordinator - Verify Claims</h1>
				<p class="text-muted mb-0">Review and verify submitted claims from lecturers</p>
			</div>
			<div class="text-end">
				<span class="badge bg-primary fs-6">@Model.Count() Pending Claims</span>
			</div>
		</div>

		@if (TempData["SuccessMessage"] != null)
		{
			<div class="alert alert-success alert-dismissible fade show" role="alert">
				<strong>‚úì Success!</strong> @TempData["SuccessMessage"]
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		}

		@if (TempData["ErrorMessage"] != null)
		{
			<div class="alert alert-danger alert-dismissible fade show" role="alert">
				<strong>‚úó Error!</strong> @TempData["ErrorMessage"]
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		}

		<div class="card shadow-sm">
			<div class="card-header bg-primary text-white">
				<h5 class="card-title mb-0">Submitted Claims Awaiting Verification</h5>
			</div>
			<div class="card-body p-0">
				@if (Model.Any())
				{
					<div class="table-responsive">
						<table class="table table-hover mb-0">
							<thead class="table-light">
								<tr>
									<th style="width: 8%;">Claim #</th>
									<th style="width: 15%;">Period</th>
									<th style="width: 12%;">Lecturer ID</th>
									<th style="width: 12%;" class="text-end">Total Hours</th>
									<th style="width: 12%;" class="text-end">Hourly Rate</th>
									<th style="width: 13%;" class="text-end">Total Amount</th>
									<th style="width: 10%;" class="text-center">Status</th>
									<th style="width: 18%;" class="text-center">Actions</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var claim in Model)
								{
									var monthName = new DateTime(claim.Year, claim.Month, 1).ToString("MMMM");

									<tr>
										<td class="fw-bold text-primary">#@claim.Id</td>
										<td>@monthName @claim.Year</td>
										<td>Lecturer @claim.LecturerId</td>
										<td class="text-end">@claim.TotalHours.ToString("N2") hrs</td>
										<td class="text-end">R @claim.HourlyRate.ToString("N2")</td>
										<td class="text-end fw-semibold">R @claim.Amount.ToString("N2")</td>
										<td class="text-center">
											<span class="badge bg-primary">@claim.Status</span>
										</td>
										<td class="text-center">
											<div class="btn-group btn-group-sm" role="group">
												<a asp-action="Review" asp-route-id="@claim.Id" class="btn btn-outline-info" title="Review Details">
													üëÅÔ∏è Review
												</a>
												<button type="button" class="btn btn-outline-success verify-btn" data-claim-id="@claim.Id" title="Verify Claim">
													‚úì Verify
												</button>
												<button type="button" class="btn btn-outline-danger reject-btn" data-claim-id="@claim.Id" title="Reject Claim">
													‚úó Reject
												</button>
											</div>
										</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
				}
				else
				{
					<div class="text-center py-5 text-muted">
						<div class="mb-3">
							<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-check2-circle" viewBox="0 0 16 16">
								<path d="M2.5 8a5.5 5.5 0 0 1 8.25-4.764.5.5 0 0 0 .5-.866A6.5 6.5 0 1 0 14.5 8a.5.5 0 0 0-1 0 5.5 5.5 0 1 1-11 0z"/>
								<path d="M15.354 3.354a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l7-7z"/>
							</svg>
						</div>
						<h5>All caught up!</h5>
						<p>There are no claims awaiting verification at the moment.</p>
					</div>
				}
			</div>
		</div>

		<div class="mt-3">
			<div class="alert alert-info small">
				<strong>‚ÑπÔ∏è Verification Process:</strong>
				<ul class="mb-0 mt-2">
					<li>Review each claim carefully by clicking "Review" to see all details and activities</li>
					<li>Verify the claim if all information is accurate and complete</li>
					<li>Reject the claim with a comment if there are discrepancies or missing information</li>
					<li>Verified claims will be forwarded to the Academic Manager for final approval</li>
				</ul>
			</div>
		</div>
	</div>
</div>

<!-- Verify Modal -->
<div class="modal fade" id="verifyModal" tabindex="-1" aria-labelledby="verifyModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="verifyForm" asp-action="VerifyClaim" method="post">
				@Html.AntiForgeryToken()
				<input type="hidden" id="verifyClaimId" name="id" />
				<div class="modal-header bg-success text-white">
					<h5 class="modal-title" id="verifyModalLabel">‚úì Verify Claim</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to verify claim <strong>#<span id="verifyClaimNumber"></span></strong>?</p>
					<div class="mb-3">
						<label for="verifyComment" class="form-label">Comment (Optional)</label>
						<textarea class="form-control" id="verifyComment" name="comment" rows="3" placeholder="Add any notes or comments..."></textarea>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-success">‚úì Verify Claim</button>
				</div>
			</form>
		</div>
	</div>
</div>

<!-- Reject Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="rejectForm" asp-action="RejectClaim" method="post">
				@Html.AntiForgeryToken()
				<input type="hidden" id="rejectClaimId" name="id" />
				<input type="hidden" name="returnTo" value="Coordinator" />
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="rejectModalLabel">‚úó Reject Claim</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to reject claim <strong>#<span id="rejectClaimNumber"></span></strong>?</p>
					<div class="mb-3">
						<label for="rejectComment" class="form-label">Reason for Rejection <span class="text-danger">*</span></label>
						<textarea class="form-control" id="rejectComment" name="comment" rows="3" placeholder="Please provide a reason for rejecting this claim..." required></textarea>
						<div class="form-text">A comment is required when rejecting a claim.</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-danger">‚úó Reject Claim</button>
				</div>
			</form>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		$(document).ready(function() {
			// Verify button click
			$('.verify-btn').click(function() {
				const claimId = $(this).data('claim-id');
				$('#verifyClaimId').val(claimId);
				$('#verifyClaimNumber').text(claimId);
				$('#verifyModal').modal('show');
			});

			// Reject button click
			$('.reject-btn').click(function() {
				const claimId = $(this).data('claim-id');
				$('#rejectClaimId').val(claimId);
				$('#rejectClaimNumber').text(claimId);
				$('#rejectModal').modal('show');
			});
		});
	</script>
}


